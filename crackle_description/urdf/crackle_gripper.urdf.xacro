<?xml version="1.0"?>
<robot xmlns:xacro="http://ros.org/wiki/xacro" name="three_claw_gripper" >
  <xacro:macro name="three_claw_gripper" params="arm_link:='link_6'">

  <!-- Common properties -->
  <xacro:property name="pkg_path" value="package://crackle_description/meshes"/>
  <xacro:property name="mesh_scale" value="1 1 1"/>
  <xacro:property name="arm_last_link" value="${arm_link}"/>

  <!-- =========================
       Macro: Gripper Base Link
       ========================= -->
  <xacro:macro name="gripper_base_macro" params="link_name base_mesh:='Claw_Casing.stl'">
    <link name="${link_name}">
      <visual>
        <origin xyz="0 0 0" rpy="0 0 1.80"/>
        <geometry>
          <mesh filename="${pkg_path}/${base_mesh}" scale="${mesh_scale}"/>
        </geometry>
      </visual>
      <color rgba="0.0 0.0 0.5 1"/>
    </link>

    <link name="spur_gear_left">
      <visual>
        <origin xyz="0 0 0" rpy="0 0 1.80"/>
        <geometry>
          <mesh filename="${pkg_path}/SpurGear_Left.stl" scale="${mesh_scale}"/>
        </geometry>
      </visual>
      <color rgba="0.0 0.0 0.5 1"/>
    </link>
  <link name="spur_gear_right">
      <visual>
        <origin xyz="0 0 0" rpy="0 0 1.80"/>
        <geometry>
          <mesh filename="${pkg_path}/SpurGear_Right.stl" scale="${mesh_scale}"/>
        </geometry>
      </visual>
      <color rgba="0.0 0.0 0.5 1"/>
    </link>

    <joint name="spur_gear_left_joint" type="revolute">
      <parent link="${link_name}"/>
      <child link="spur_gear_left"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <axis xyz="0 0 1"/>
      <limit lower="-3.14159" upper="3.14159" effort="5.0" velocity="5.0"/>
    </joint>
    <joint name="spur_gear_right_joint" type="revolute">
      <parent link="${link_name}"/>
      <child link="spur_gear_right"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <axis xyz="0 0 1"/>
      <limit lower="-3.14159" upper="3.14159" effort="5.0" velocity="5.0"/>
    </joint>
  </xacro:macro>

  <!-- =========================
       Instantiate the Gripper
       ========================= -->

  <!-- 1) Base link -->
  <xacro:gripper_base_macro link_name="gripper_base"/>

  <!-- 2) Fixed joint to arm -->
  <joint name="gripper_base_joint" type="fixed">
    <parent link="${arm_last_link}"/>
    <child link="gripper_base"/>
    <origin xyz="0 0 0.025" rpy="0.0 0 -0.78"/> <!-- 0.78 -->
  </joint>

  <link name="camera_depth_optical_frame">
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="${pkg_path}/realsense_d435i.stl" scale="${mesh_scale}"/>
      </geometry>
      <material name="blue">
        <color rgba="0.0 0.0 0.5 1"/>
      </material>
    </visual>
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <mass value="0.1"/>
      <inertia ixx="0.001" ixy="0.0" ixz="0.0"
               iyy="0.001" iyz="0.0"
               izz="0.001"/>
    </inertial>
  </link>

  <joint name="camera_depth_optical_frame_joint" type="fixed">
    <parent link="gripper_base"/>
    <child link="camera_depth_optical_frame"/>
    <origin xyz="-0.08 0 0.03" rpy="0 0 -1.57"/>
  </joint>

  </xacro:macro> 

</robot>
